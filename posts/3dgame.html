<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="../css/style.css?Sun Aug 25 13:17:26 2019" />
	<link rel="alternate" type="application/rss+xml" title="pennie-quinn.github.io posts" href="../posts.xml" />
	<title>Let's Write a 3D Game in JS</title>
	
	<script type="text/javascript">
		window.site_root = "..";
	</script>
	
	<script type="text/javascript">
  if (window.location.hostname != "localhost") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-127983421-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
</script>
</head>

<body class="nice_fonts">
	
<div class="sidebar">
	<a href="../index.html" title="pennie.net">
		<img class="logo" src="../img/devnull.svg" alt="pennie.net" />
	</a>

	<p class="center">Pennie's ramblings.</p>

	<div class="sidebar_icons">
		<a href="mailto:pennie.ada.quinn@gmail.com"><img src="../img/icon/mail.svg" alt="email" /></a>
		<a href="https://twitter.com/transmutrix"><img src="../img/icon/twitter.svg" alt="twitter" /></a>
		<a href="https://github.com/pennie-quinn"><img src="../img/icon/github.svg" alt="github" /></a>
		<a href="https://pennie.itch.io"><img src="../img/icon/itchio.svg" alt="itch" /></a>
	</div>

	<br>

	<p>Recent Posts</p>
	<p><a href='https://pennie-quinn.github.io/posts/zelda-screens.html'>Making the Same Stuff With Different Tools</a></p>
<p><a href='https://pennie-quinn.github.io/posts/hillcipher.html'>The Lester Hill Cipher</a></p>
<p><a href='https://pennie-quinn.github.io/posts/going-full-bananacakes.html'>Going Full Bananacakes</a></p>

</div>

<div class="main-column">

<div class="post-header">
	<img class="cover" src="../img/default.png" alt="Let's Write a 3D Game in JS" />
	<h1>Let's Write a 3D Game in JS</h1>
	<div class="post-meta">
		Posted
		<span class: "post-date">Thu, Aug 15,
2019</span>
		by Pennie (<a href="https://twitter.com/transmutrix">@transmutrix</a>)
	</div>
</div>

<div class="inner post-body"><h2>Introduction</h2>

<p>Recently, I recieved some career advice and resume help, and
the person helping me said that it would improve my game dev
resume to have at least one 3D project on it.</p>

<p>This sounds like good advice, especially given how niche,
meaning ultra low-fi, my 2D projects have been.</p>

<p>I was suggested to use Unity, given its ubiquity, but I soon
will be doing most work remotely on an iPad between classes,
and won&rsquo;t have hours to spend in Unity at my desk.</p>

<p>Lately, I have been experimenting with game dev with JS.
Coming from Native Programming Land, it has been interesting
(and at times irritating).</p>

<p>So, why not both make my first 3D game <em>and</em> learn some JS
game dev, together?</p>

<h2>Tools &amp; Environment</h2>

<p>I recently set up a <a href="https://github.com/pennie-quinn/phaser-template">simple environment</a> for writing
games in <a href="https://coffeescript.org">CoffeeScript</a>, with <a href="https://phaser.io">Phaser 3</a>. I did so
because I don&rsquo;t like using massive build systems or curating
labyrinthine dependency trees. :)</p>

<p>Since I already have that, the next question is: <em>Which of
the seemingly many WebGL libraries and game frameworks for
JS do I try out?</em></p>

<p>After checking most of the entries on <a href="https://github.com/collections/javascript-game-engines">this list</a>, I
decided <a href="https://github.com/mrdoob/three.js">three.js</a> looks the best (and the most recently
worked on). It provides no integrated physics engine or
modeling capabilities, leaving the fun stuff for me to
figure out.</p>

<h2>Setting Up</h2>

<p>Let&rsquo;s grab our files:</p>

<pre class="highlight lang_fish"><code><span></span><span class="k">cd</span> ~/projects
git clone https://github.com/pennie-quinn/phaser-template.git 3dgame
<span class="k">cd</span> 3dgame
wget -O src/three.min.js http://threejs.org/build/three.min.js</code>
</pre>


<p>And let&rsquo;s paste the three.js Hello World code into our
<code>src/app.coffee</code>, in an inline js block:</p>

<pre class="highlight lang_coffeescript"><code><span></span><span class="nx">import</span> <span class="s">&#39;./three.min.js&#39;</span>

<span class="o">`</span>
<span class="nx">var</span> <span class="nx">camera</span><span class="p">,</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">;</span>
<span class="nx">var</span> <span class="nx">geometry</span><span class="p">,</span> <span class="nx">material</span><span class="p">,</span> <span class="nx">mesh</span><span class="p">;</span>

<span class="nx">init</span><span class="p">();</span>
<span class="nx">animate</span><span class="p">();</span>

<span class="nx">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">camera = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span> <span class="mi">70</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span> <span class="p">);</span>
    <span class="nv">camera.position.z = </span><span class="mi">1</span><span class="p">;</span>

    <span class="nv">scene = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">();</span>

    <span class="nv">geometry = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">BoxGeometry</span><span class="p">(</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span> <span class="p">);</span>
    <span class="nv">material = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshNormalMaterial</span><span class="p">();</span>

    <span class="nv">mesh = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span> <span class="nx">geometry</span><span class="p">,</span> <span class="nx">material</span> <span class="p">);</span>
    <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">mesh</span> <span class="p">);</span>

    <span class="nv">renderer = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span><span class="p">(</span> <span class="p">{</span> <span class="nv">antialias: </span><span class="kc">true</span> <span class="p">}</span> <span class="p">);</span>
    <span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span> <span class="p">);</span>
<span class="p">}</span>

<span class="nx">function</span> <span class="nx">animate</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">requestAnimationFrame</span><span class="p">(</span> <span class="nx">animate</span> <span class="p">);</span>

    <span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mf">0.02</span><span class="p">;</span>

    <span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span> <span class="p">);</span>
<span class="p">}</span>
<span class="o">`</span></code>
</pre>


<p>Ok, that works.</p>

<p><img src="../img/3d/hello.png" alt="hello world screenshot" /></p>

<p>Now let&rsquo;s convert that to CoffeeScript. First we need to put
the calls to <code>init</code> and <code>animate</code> at the <em>end</em> of the file,
since the functions won&rsquo;t be hoisted.</p>

<p>Then, we mostly need to pour lots of syntactic sugar, with
consideration given to how variables and scoping work in
CoffeeScript :)</p>

<pre class="highlight lang_coffeescript"><code><span></span><span class="nv">state = </span><span class="p">{}</span>

<span class="nv">init = </span><span class="nf">-&gt;</span>
    <span class="nv">state.camera = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span> <span class="mi">70</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span>
    <span class="nv">state.camera.position.z = </span><span class="mi">1</span>

    <span class="nv">state.scene = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">()</span>

    <span class="nv">geometry = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">BoxGeometry</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span>
    <span class="nv">material = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshNormalMaterial</span><span class="p">()</span>

    <span class="nv">state.mesh = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span> <span class="nx">geometry</span><span class="p">,</span> <span class="nx">material</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span> <span class="nx">state</span><span class="p">.</span><span class="nx">mesh</span>

    <span class="nv">state.renderer = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span>  <span class="p">{</span> <span class="nv">antialias: </span><span class="kc">true</span> <span class="p">}</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">state</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span>

<span class="nv">animate = </span><span class="nf">-&gt;</span>
    <span class="nx">requestAnimationFrame</span> <span class="nx">animate</span>

    <span class="nx">state</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="mf">0.01</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mf">0.02</span>

    <span class="nx">state</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span> <span class="nx">state</span><span class="p">.</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">camera</span>


<span class="nx">init</span><span class="p">()</span>
<span class="nx">animate</span><span class="p">()</span></code>
</pre>


<p>And let&rsquo;s go ahead and OOP it up a bit, for cleanliness:</p>

<pre class="highlight lang_coffeescript"><code><span></span><span class="k">class</span> <span class="nx">Game</span>
    <span class="nv">constructor: </span><span class="nf">-&gt;</span>
        <span class="vi">@camera = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span> <span class="mi">70</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span>
        <span class="vi">@camera.position.z = </span><span class="mi">1</span>

        <span class="vi">@scene = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">()</span>

        <span class="nv">geometry = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">BoxGeometry</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span>
        <span class="nv">material = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshNormalMaterial</span><span class="p">()</span>

        <span class="vi">@mesh = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span> <span class="nx">geometry</span><span class="p">,</span> <span class="nx">material</span>
        <span class="nx">@scene</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@mesh</span>

        <span class="vi">@renderer = </span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span>  <span class="p">{</span> <span class="nv">antialias: </span><span class="kc">true</span> <span class="p">}</span>
        <span class="nx">@renderer</span><span class="p">.</span><span class="nx">setSize</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">@renderer</span><span class="p">.</span><span class="nx">domElement</span>

    <span class="nv">animate: </span><span class="nf">-&gt;</span>
        <span class="nx">@mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="mf">0.01</span>
        <span class="nx">@mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mf">0.02</span>
        <span class="nx">@renderer</span><span class="p">.</span><span class="nx">render</span> <span class="nx">@scene</span><span class="p">,</span> <span class="nx">@camera</span>


<span class="nv">game = </span><span class="k">new</span> <span class="nx">Game</span><span class="p">()</span>

<span class="nv">update = </span><span class="nf">-&gt;</span>
    <span class="nx">requestAnimationFrame</span> <span class="nx">update</span>
    <span class="nx">game</span><span class="p">.</span><span class="nx">animate</span><span class="p">()</span>

<span class="nx">update</span><span class="p">()</span></code>
</pre>


<p>We could handle our variables in a more data-driven,
separated way, but I want to experiment with classes for
now. If it becomes a problem when we want to do live reloads
or something, we can fix it. :)</p>

<h2>Getting Started</h2>

<p>First, let&rsquo;s try loading a model!</p>

<pre class="highlight lang_fish"><code><span></span>wget -O src/OBJLoader.js https://raw.githubusercontent.com/mrdoob/three.js/master/examples/jsm/loaders/OBJLoader.js
wget -O src/GLTFLoader.js https://raw.githubusercontent.com/mrdoob/three.js/master/examples/jsm/loaders/GLTFLoader.js
mkdir assets</code>
</pre>


<p>I can&rsquo;t get either of these loaders to work with given
examples. A console dump reveals that the models are, in
fact, being loaded. I tried scaling loaded models by a large
factor, just in case, but that yielded nothing as well.</p>
</div>
</div>

	
	<div class="footer">
		<p>
			Copyright &copy; Pennie Quinn 2019
			&middot;
			Generated on Sun Aug 25 13:17:26 2019
			&middot;
			<a href="../index.html">Home</a>
		</p>
	</div>
	
	<script type="text/javascript">
		//if (navigator.appVersion.indexOf("Win") >= 0) { document.body.className=""; }
	</script>
</body>
</html>